---
output: html_document
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 72
---

```{r setup-198220, eval = F}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
source('scripts/packages.R')
source('scripts/tables.R')

```

```{r  load-data-198220}
my_site <- 198220
my_site2 <- 8300012
```

`r fpr::fpr_appendix_title()`

## Site Location {.unnumbered}

PSCIS crossing `r as.character(my_site)` is located on
`r fpr::fpr_my_pscis_info()`. The site is located on
`r fpr_my_pscis_info(col_pull = road_name)`. Crossing
`r as.character(my_site)` was located
`r round(fpr::fpr_my_bcfishpass(col_pull = downstream_route_measure)*0.001, 1)`km
upstream from the confluence with the Kitwanga River. A modelled
crossing located approximately 200m upstream was also assessed and is
discussed below.

<br>

## Background {.unnumbered}

At crossing `r as.character(my_site)`, `r fpr::fpr_my_pscis_info()` is a
`r fpr::fpr_my_bcfishpass() %>% english::ordinal()` order stream with a
watershed area upstream of the crossing of approximately
`r fpr::fpr_my_wshd()`km^2^. The elevation of the watershed ranges from
a maximum of `r fpr::fpr_my_wshd(col = 'elev_max')`m to
`r fpr::fpr_my_wshd(col = 'elev_min')`m near the crossing (Table
\@ref(tab:tab-wshd-198220)). Upstream of crossing
`r as.character(my_site)`, `r fpr::fpr_my_fish_sp()` have previously
been recorded [@moe2020KnownBC; @norris2020bcfishobs].

<br>

```{r tab-wshd-198220, eval = T}
fpr::fpr_table_wshd_sum(site_id = my_site) %>% 
  fpr::fpr_kable(caption_text = paste0('Summary of derived upstream watershed statistics for PSCIS crossing ', my_site, '.'),
           footnote_text = 'Elev P60 = Elevation at which 60% of the watershed area is above',
           scroll = F)

```

<br>

In partnerships with DFO, MELP, HCTF, and non-governmental organizations (Gitanyow Fisheries Authorities and the Steelhead Society of BC), the Ministry of Transportation installed backwater weir structures in the 1990's at crossing `r as.character(my_site)`. The weir structure included seven weirs and was designed to reduce the outlet drop and facilitate upstream fish passage migration. Instead of using rock, notched pre-cast concrete lock blocks were utilised to make the plunge pools. To prevent streambed scour, the outlet was armored with riprap. A bottomless pipe arch was installed in 1998 at the Moore Road crossing, at a 3% gradient [@sweeting].

<br>

PSCIS stream crossing `r as.character(my_site)` was ranked as a high
priority for follow up by the Society for Ecosystem Restoration in
Northern BC due to the large size of the stream, with many species
confirmed upstream. A summary of habitat modelling outputs is presented
in Table \@ref(tab:tab-culvert-bcfp-198220). A map of the watershed is
provided in map attachment
[`r fpr::fpr_my_bcfishpass(col_pull = dbm_mof_50k_grid)`](`r fpr::fpr_my_mapsheet(wshd = "kisp", archive_date = "2022-09-06")`).

<br>

```{r tab-culvert-bcfp-198220, eval = T}
fpr::fpr_table_bcfp(scroll = gitbook_on) 
```

<br>

## Stream Characteristics at Crossing {.unnumbered}

At the time of the survey, PSCIS crossing `r as.character(my_site)` was
un-embedded, non-backwatered and ranked as a
`r fpr::fpr_my_pscis_info(col_pull = barrier_result) %>% stringr::str_to_lower()`
barrier to upstream fish passage according to the provincial protocol
[@moe2011Fieldassessment] (Table \@ref(tab:tab-culvert-198220)). There
was low flow through the culvert at the time of survey. However, a deep
outlet pool was present indicating high flows do occur and that the
culvert may be undersized. Water temperature was
`r fpr::fpr_my_habitat_info(loc = "us", col_pull = 'temperature_c')`$^\circ$C,
pH was `r fpr::fpr_my_habitat_info(loc = "us", col_pull = 'p_h')` and
conductivity was
`r fpr::fpr_my_habitat_info(loc = "us", col_pull = 'conductivity_m_s_cm')`uS/cm.

`r if(identical(gitbook_on, FALSE)){knitr::asis_output("\\pagebreak")}`
<br>

```{r tab-culvert-198220, eval = T}
fpr::fpr_table_cv_summary_memo()

```

```{r eval=F}
##this is useful to get some comments for the report
hab_site %>% filter(site == my_site & location == 'ds') %>% pull(comments)
hab_site %>% filter(site == my_site & location == 'us') %>% pull(comments)

```

## Stream Characteristics Downstream {.unnumbered}

`r fpr_my_survey_dist(loc = 'ds')`
`r if(gitbook_on){knitr::asis_output("(Figures \\@ref(fig:photo-198220-01) - \\@ref(fig:photo-198220-02)).")}else(knitr::asis_output("(Figure \\@ref(fig:photo-198220-d01))."))`
`r fpr_my_habitat_paragraph(loc = 'ds')`  There was boulder cover and gravels throughout the survey but very few pools. Tea Creek is a known steelhead stream with local landowner reporting spawning in tributaries of the highway. The
habitat was rated as `r fpr::fpr_my_priority_info(loc = 'ds')` value for
salmonid rearing and spawning.

## Stream Characteristics Upstream {.unnumbered}

`r fpr_my_survey_dist(loc = 'us')`
`r if(gitbook_on){knitr::asis_output("(Figures \\@ref(fig:photo-198220-03) - \\@ref(fig:photo-198220-06)).")}else(knitr::asis_output("(Figure \\@ref(fig:photo-198220-d02))."))`
`r fpr_my_habitat_paragraph(loc = 'us')` Only a few areas contained gravels suitable for spawning. The stream substrate was predominantly cobbles. The channel was wide throughout with a lot of woody debris. There were large amounts of undercut banks that provided cover, but not many deep pools. Some steep eroding banks were seen in a few locations on the survey. The habitat was rated as
`r fpr::fpr_my_priority_info(loc = 'us')` value as an important
migration corridor containing suitable spawning habitat and having
moderate rearing potential.

The culvert located 200m upstream from PSCIS crossing
`r as.character(my_site)` on Moore Road was assessed and ranked as
passable to all species and life stages at the time of survey. The
crossing was embedded and non backwatered (Table
\@ref(tab:tab-culvert-8300012)).

```{r tab-culvert-8300012, eval = T}
fpr::fpr_table_cv_summary_memo(dat = pscis_phase1, site = my_site2, site_photo_id = my_site2, col_filter = my_crossing_reference)
```

## Structure Remediation and Cost Estimate {.unnumbered}

<br>

## Conclusion {.unnumbered}

There was
`r fpr::fpr_my_priority_info(col_pull= upstream_habitat_length_km)`km of
habitat modelled upstream of crossing `r as.character(my_site)` with
areas surveyed rated as
`r fpr::fpr_my_priority_info(sit = my_site, loc = 'us', col_pull = hab_value)`
value for salmonid rearing and spawning. `r as.character(my_site)` was ranked as a
`r fpr::fpr_my_priority_info(col_pull = priority)` priority for
proceeding to design for replacement. Electrofishing upstream and
downstream of the culvert is recommended to provide insight into fish
community composition and density which may justify a higher priority
for site remediation.

`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\pagebreak")`

<br>

```{r tab-habitat-summary-198220}
tab_hab_summary %>% 
  filter(Site  == my_site) %>% 
  # select(-Site) %>% 
  fpr::fpr_kable(caption_text = paste0('Summary of habitat details for PSCIS crossing ', my_site, '.'),
                 scroll = F) 

```

<br>

```{r photo-198220-01-prep, eval=T}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = '_d1_')

my_caption1 = paste0('Typical habitat downstream of PSCIS crossing ', my_site, '.')


```

```{r photo-198220-01, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo1))
```

<br>

```{r photo-198220-02-prep}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = '_d2_')

my_caption2 = paste0('Typical habitat downstream of PSCIS crossing ', my_site, '.')
```

```{r photo-198220-02, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo2))

```

<br>

```{r photo-198220-d01, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```

```{r photo-198220-03-prep}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u1_')

my_caption1 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')
```

```{r photo-198220-03, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo1))
```

<br>

```{r photo-198220-04-prep}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u2_')

my_caption2 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')

```

```{r photo-198220-04, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo2))
```

```{r photo-198220-d02, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```

<br>

```{r photo-198220-05-prep}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u3_')

my_caption1 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')
```

```{r photo-198220-05, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo1))
```

<br>

```{r photo-198220-06-prep}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u4_')

my_caption2 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')

```

```{r photo-198220-06, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo2))
```

```{r photo-198220-d04, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```
