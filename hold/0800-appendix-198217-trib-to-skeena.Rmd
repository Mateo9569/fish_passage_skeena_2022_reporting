---
output: html_document
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 72
---

```{r setup-198217, eval = F}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
source('scripts/packages.R')
source('scripts/tables.R')

```

```{r  load-data-198217}
my_site <- 198216
my_site2 <- 198217
```

`r fpr::fpr_appendix_title(site2 = my_site2)`

## Site Location {.unnumbered}

PSCIS crossing `r as.character(my_site)` and `r as.character(my_site2)`
are located on a `r fpr::fpr_my_pscis_info()`, just outside the small
community of of Sik-E-Dakh (Glen Vowell). Crossing `r as.character(my_site)` is
located `r round(fpr::fpr_my_bcfishpass(site = my_site, col_pull = downstream_route_measure)*0.001, 1)`km
upstream from the confluence with the Skeena River on `r fpr_my_pscis_info(col_pull = road_name)` and is the responsibility of the Ministry of
Transportation and Infrastructure.
`r as.character(my_site2)` is located on
`r fpr_my_pscis_info(site = my_site2, col_pull = road_name)` 300m upstream from `r fpr_my_pscis_info(col_pull = road_name)` and is under the jurisdiction of Sik-E-Dakh.

<br>

## Background {.unnumbered}

Located on the west side of the Skeena River, between Hazelton and Kispiox, Sik-E-Dakh is a Gitxsan community home to the Glen Vowell Band. "Sik-E-Dakh" means "Bright Lights Behind Mountain" [@SikEDakhGlenVowellBand2023]. The subject stream supplies drinking water to the community with drinking water storage and treatment infrastructure located on `r fpr_my_pscis_info(site = my_site2, col_pull = road_name)` beyone the location of `r as.character(my_site2)`.


At crossing `r as.character(my_site)`, `r fpr::fpr_my_pscis_info()` is a
`r fpr::fpr_my_bcfishpass() %>% english::ordinal()` order stream with a
watershed area upstream of the crossing of approximately
`r fpr::fpr_my_wshd()`km^2^. The elevation of the watershed ranges from
a maximum of `r fpr::fpr_my_wshd(col = 'elev_max')`m to
`r fpr::fpr_my_wshd(col = 'elev_min')`m near the crossing (Table
\@ref(tab:tab-wshd-198217)). At the time of reporting, there was no
fisheries information available for the area upstream of the highway crossing
`r as.character(my_site)` [@moe2020KnownBC; @norris2020bcfishobs]. Local knowledge holder (Chief Francis), noted that the local community used to historically harvest coho from the stream. Gitsxan Watershed Authority and local residents are working together to gather information about the system from elders and other local knowledge holders in the community to help inform watershed restoration planning.  There is concern in the community that the stream flows are not as consistent than in the past and there are hopes that restoration activities could help increase fisheries productivity in the system. There is a network of dykes surrounding the Sik-e-Dakh community.

<br>

```{r tab-wshd-198217, eval = T}
fpr::fpr_table_wshd_sum(site_id = my_site) %>% 
  fpr::fpr_kable(caption_text = paste0('Summary of derived upstream watershed statistics for PSCIS crossing ', my_site, '.'),
           footnote_text = 'Elev P60 = Elevation at which 60% of the watershed area is above',
           scroll = F)

```







A summary of habitat modelling outputs are presented in Tables
\@ref(tab:tab-culvert-bcfp-198217) and
\@ref(tab:tab-culvert-bcfp-198216). A map of the watershed is provided
in map attachment
[`r fpr::fpr_my_bcfishpass(col_pull = dbm_mof_50k_grid)`](`r fpr::fpr_my_mapsheet(wshd = "kisp", archive_date = "2022-09-06")`).

<br>

```{r tab-culvert-bcfp-198217, eval = T}
fpr::fpr_table_bcfp(scroll = gitbook_on) 
```

<br>

```{r tab-culvert-bcfp-198216, eval = T}
fpr::fpr_table_bcfp(site = my_site2, scroll = gitbook_on) 
```

<br>

## Stream Characteristics at Crossings {.unnumbered}

At the time of the survey, PSCIS crossing `r as.character(my_site)` was
un-embedded, non-backwatered and ranked as a
`r fpr::fpr_my_pscis_info(col_pull = barrier_result) %>% stringr::str_to_lower()`
to upstream fish passage according to the provincial protocol
[@moe2011Fieldassessment] (Table \@ref(tab:tab-culvert-198217)). There
were two perched culverts present side by side, with good flow but a
0.6m outlet drop. Water temperature was
`r fpr::fpr_my_habitat_info(loc = "ds", col_pull = 'temperature_c')`$^\circ$C,
pH was `r fpr::fpr_my_habitat_info(loc = "ds", col_pull = 'p_h')` and
conductivity was
`r fpr::fpr_my_habitat_info(loc = "ds", col_pull = 'conductivity_m_s_cm')`uS/cm.

<br>

PSCIS crossing `r as.character(my_site2)` was embedded, backwatered and
ranked as
`r fpr::fpr_my_pscis_info(site = my_site2, col_pull = barrier_result)`
to upstream fish passage (Table \@ref(tab:tab-culvert-198216)). There
were two culverts side by side, and both of them had trash racks on the
inlet side that could be a barrier to adult coho. The trash rack had
grid sizes of approximately 13cm by 13cm (shown in Figure
\@ref(fig:photo-198216-rack)).

`r if(identical(gitbook_on, FALSE)){knitr::asis_output("\\pagebreak")}`
<br>

```{r tab-culvert-198217, eval = T}
fpr::fpr_table_cv_summary_memo()

```

<br>

```{r tab-culvert-198216, eval = T}
fpr::fpr_table_cv_summary_memo(site = my_site2, site_photo_id = my_site2)

```

<br>

```{r eval=F}
##this is useful to get some comments for the report
hab_site %>% filter(site == my_site & location == 'ds') %>% pull(comments)
hab_site %>% filter(site == my_site & location == 'us') %>% pull(comments)

```

```{r photo-198216-rack-prep, eval=T}
my_photo1 = fpr::fpr_photo_pull_by_str(site = my_site, str_to_pull = '_trashrack_')

my_caption1 = paste0('Trash rack on inlet side of PSCIS crossing ', my_site, '.')


```

```{r photo-198216-rack, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo1))
```

<br>

## Stream Characteristics Downstream of `r as.character(my_site)` ` {.unnumbered}

`r fpr_my_survey_dist(loc = 'us')`
`r if(gitbook_on){knitr::asis_output("(Figures \\@ref(fig:photo-198217-03) - \\@ref(fig:photo-198217-06)).")}else(knitr::asis_output("(Figure \\@ref(fig:photo-198217-d01))."))`
`r fpr_my_habitat_paragraph(loc = 'us')` Abundant gravels were present
suitable for coho, steelhead, and rainbow spawning. Multiple large beaver dams were
present within the area surveyed. Upstream end of site was
adjacent to a beaver dam complex. The habitat was
rated as `r fpr::fpr_my_priority_info(loc = 'us')` value for salmonid
rearing and spawning.

<br>

## Stream Characteristics Upstream of `r as.character(my_site)` and Downstream of `r as.character(my_site2)`  {.unnumbered}

`r fpr_my_survey_dist(loc = 'us')` to the Sik-e-dakh Water Tower Road
`r if(gitbook_on){knitr::asis_output("(Figures \\@ref(fig:photo-198217-01) - \\@ref(fig:photo-198217-02)).")}else(knitr::asis_output("(Figure \\@ref(fig:photo-198217-d02))."))`
`r fpr_my_habitat_paragraph(loc = 'us')` Mostly wetland habitat, with
three big beaver dams spaced evenly along surveyed length. Multiple
channels were present after the first beaver dam, separated by heavily
vegetated banks. There was muddy bed material with some fines and
gravels but nothing bigger. More gravels were present closer to crossing
`r as.character(my_site2)` that were suitable for spawning. Deep pools
present near wetland that could be suitable for rearing if habitat is
opened up. The habitat was rated as
`r fpr::fpr_my_priority_info(loc = 'ds')` value as an important
migration corridor containing suitable spawning habitat and having
moderate rearing potential. The area immediately upstream of
`r as.character(my_site2)` was also surveyed by drone (shown below).

<br>

## Stream Characteristics Downstream of `r as.character(my_site2)` {.unnumbered}

Surveys were conducted with a remotely piloted aircraft downstream of
the crossing with resulting images stitched into an orthomosaic
`r if(gitbook_on){knitr::asis_output(" presented in Figures \\@ref(fig:ortho-caption-198216) - \\@ref(fig:model-caption-198216).")} else knitr::asis_output("presented [here](https://www.mapsmadeeasy.com/maps/public/744a9804752947d9ba769e53b8c9deec/) and [here](https://www.mapsmadeeasy.com/maps/public_3D/744a9804752947d9ba769e53b8c9deec/).")`

<br>

```{r ortho-198216, eval = identical(gitbook_on, TRUE)}
model_url <- '<iframe src="https://www.mapsmadeeasy.com/maps/public/744a9804752947d9ba769e53b8c9deec/" scrolling="no" title="Maps Made Easy" width="100%" height="600" frameBorder ="0"></iframe>'

knitr::asis_output(model_url)
```

```{r ortho-caption-198216, fig.cap= my_caption, out.width = "0.01%", eval = identical(gitbook_on, TRUE)}
my_photo = 'fig/pixel.png'

my_caption = paste0('Orthomosaic of habitat upstream and downstream of PSCIS crossing 198216.')

knitr::include_graphics(my_photo, dpi = NA)

```

<br>

```{r model-198216, eval = identical(gitbook_on, TRUE)}
model_url <- '<iframe src="https://www.mapsmadeeasy.com/maps/public_3D/744a9804752947d9ba769e53b8c9deec/" scrolling="no" title="Maps Made Easy" width="100%" height="600" frameBorder ="0"></iframe>'

knitr::asis_output(model_url)
```

```{r model-caption-198216, fig.cap= my_caption, out.width = "0.01%", eval = identical(gitbook_on, TRUE)}
my_photo = 'fig/pixel.png'

my_caption = paste0('3D model of habitat upstream and downstream of PSCIS crossing 198216. To zoom press "shift" and scroll.')

knitr::include_graphics(my_photo, dpi = NA)

```

<br>

## Structure Remediation and Cost Estimate {.unnumbered}

<br>

## Conclusion {.unnumbered}

There was
`r fpr::fpr_my_priority_info(col_pull= upstream_habitat_length_km)`km of
habitat modelled upstream of crossing `r as.character(my_site)` with
areas surveyed rated as
`r fpr::fpr_my_priority_info(sit = my_site, loc = 'us', col_pull = hab_value)`
value for coho rearing and spawning. Electrofishing upstream and
downstream of the culverts is recommended to provide insight into fish
community composition and density.

`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\pagebreak")`

<br>

```{r tab-habitat-summary-198217}
tab_hab_summary %>% 
  filter(Site  == my_site) %>% 
  # select(-Site) %>% 
  fpr::fpr_kable(caption_text = paste0('Summary of habitat details for PSCIS crossing ', my_site, '.'),
                 scroll = F) 

```

<br>

```{r photo-198217-01-prep, eval=T}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = '_d1_')

my_caption1 = paste0('Typical habitat downstream of PSCIS crossing ', my_site, '.')


```

```{r photo-198217-01, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo1))
```

<br>

```{r photo-198217-02-prep}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = '_d2_')

my_caption2 = paste0('Typical habitat downstream of PSCIS crossing ', my_site, '.')
```

```{r photo-198217-02, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo2))

```

<br>

```{r photo-198217-d01, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```

```{r photo-198217-03-prep}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u1_')

my_caption1 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')
```

```{r photo-198217-03, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo1))
```

<br>

```{r photo-198217-04-prep}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u2_')

my_caption2 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')

```

```{r photo-198217-04, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo2))
```

```{r photo-198217-d02, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```

<br>

```{r photo-198217-05-prep}
my_photo1 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u3_')

my_caption1 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')
```

```{r photo-198217-05, fig.cap= my_caption1, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo1))
```

<br>

```{r photo-198217-06-prep}
my_photo2 = fpr::fpr_photo_pull_by_str(str_to_pull = '_u4_')

my_caption2 = paste0('Typical habitat upstream of PSCIS crossing ', my_site, '.')

```

```{r photo-198217-06, fig.cap= my_caption2, out.width = photo_width, eval=gitbook_on}
grid::grid.raster(jpeg::readJPEG(my_photo2))
```

```{r photo-198217-d04, fig.cap = my_caption, fig.show="hold", out.width= c("49.5%","1%","49.5%"), eval=identical(gitbook_on, FALSE)}

my_caption <- paste0('Left: ', my_caption1, ' Right: ', my_caption2)

knitr::include_graphics(my_photo1)
knitr::include_graphics("fig/pixel.png")
knitr::include_graphics(my_photo2)
```
